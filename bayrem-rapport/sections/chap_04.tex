\chapter{Implementation and Results}

\section{Introduction}
This chapter presents the practical implementation of the Car Rental Platform. It details how the system architecture, design decisions, and core functionalities have been translated into a working product. The chapter is organized by module, describing role-specific components, backend logic, frontend interaction, security integration, third-party service connections, and test scenarios. Screenshots and results are included to illustrate the platform’s functionalities.

\section{System Modules Implementation}
The application is organized into modular components corresponding to specific functionalities, user roles, and workflows. Each module is independently testable, scalable, and maintained in alignment with the microservice architecture.

\subsection{Authentication and Authorization Module (Keycloak)}
\begin{itemize}
    \item Role-based access control is implemented using Keycloak.
    \item Users are authenticated via OAuth2 and issued JWT tokens.
    \item Angular AuthGuard protects Admin, Agency, and Customer dashboards.
    \item Spring Boot backend routes are secured with role-based annotations (e.g., \texttt{@PreAuthorize}, \texttt{@RolesAllowed}).
\end{itemize}

\subsection{Admin Module}
\begin{itemize}
    \item Add, update, and delete agencies.
    \item Manage customers and blogs (CRUD operations).
    \item View and manage all bookings.
    \item Communicate with agencies via real-time chat.
\end{itemize}

\subsection{Agency Module}
\begin{itemize}
    \item Add, edit, and delete cars.
    \item Upload photos for existing cars.
    \item Manage availability and booking requests.
    \item Accept or decline rental requests, triggering email and notification.
    \item Communicate with admin via real-time chat interface.
\end{itemize}

\subsection{Customer Module}
\begin{itemize}
    \item Browse available cars and blogs.
    \item Register and log in with Keycloak (or browse as a visitor).
    \item Submit rental requests for available cars.
    \item Receive notifications and emails upon status changes.
    \item View rental history and delete unconfirmed or declined requests.
    \item Comment on car listings and blogs.
    \item Receive PDF contract with QR code after payment confirmation.
\end{itemize}

\subsection{Chatbot Module (FastAPI + ChatGPT)}
\begin{itemize}
    \item FastAPI backend receives questions from the frontend.
    \item OpenAI’s ChatGPT API generates responses.
    \item Replies are displayed to customers and visitors.
    \item Supports multilingual queries (French and English).
\end{itemize}

\subsection{Online Payment Module}
\begin{itemize}
    \item Upon booking acceptance, a payment link is sent to the user’s email.
    \item Payment is processed and validated through the Spring Boot backend.
    \item A PDF with QR code is generated and sent after payment confirmation.
    \item Booking status updated to “confirmed”.
\end{itemize}

\subsection{Notification and Email System}
\begin{itemize}
    \item Customers receive emails for new cars, booking decisions, or updates.
    \item Followers (visitors who submit emails) receive notifications for new car listings.
    \item Notifications are stored in the database and displayed in-app.
\end{itemize}

\subsubsection{Email Confirmation System}
When an agency approves a rental request, the system automatically generates and sends a confirmation email to the customer. This email contains all booking details and a PDF contract with a unique QR code for verification.

\textbf{Email Workflow:}
\begin{enumerate}
    \item Agency clicks "Approve" on a pending rental request.
    \item Backend generates a PDF contract with booking details.
    \item A unique QR code is embedded in the PDF for verification at pickup.
    \item Email service sends the confirmation with PDF attachment.
    \item Customer receives instant notification (in-app + email).
    \item Booking status changes from "PENDING" to "APPROVED".
\end{enumerate}

\textbf{Example: Confirmation Email Sent to Customer}

Figure~\ref{fig:email_confirmation} shows a real example of a confirmation email sent to a customer after their booking was approved.

\begin{figure}[h!]
    \centering
    \fbox{
    \begin{minipage}{0.85\textwidth}
    \vspace{0.5cm}
    \begin{center}
    \textbf{\Large Confirmation de Réservation}
    \end{center}
    \vspace{0.3cm}
    
    \textbf{Chèr(e) Notre Client(e),}
    
    \vspace{0.3cm}
    
    \begin{tabular}{ll}
    \textbf{Nom:} & Aloui \\
    \textbf{Email:} & zahidaaloui506@gmail.com \\
    \textbf{Message:} & Votre réservation pour \textbf{CLA A} a été confirmée. \\
    \end{tabular}
    
    \vspace{0.5cm}
    
    Nous vous remercions de votre confiance.
    
    \vspace{0.3cm}
    
    Pour toute question supplémentaire, notre équipe reste à votre disposition.
    
    \vspace{0.5cm}
    
    \begin{center}
    % Note: Add your QR code image here (img/qr-code-example.png)
    % Or use a placeholder box:
    \fbox{\parbox{2.5cm}{\centering\vspace{1cm}\textbf{QR Code}\\\small(Scan at pickup)\vspace{1cm}}}
    
    \small\textit{Scannez ce QR code lors de la récupération du véhicule}
    \end{center}
    
    \vspace{0.3cm}
    
    \hrule
    \vspace{0.2cm}
    \small
    \textit{Cet email a été envoyé automatiquement par la plateforme MyLoc.}
    
    \textit{Ne pas répondre à cet email.}
    \vspace{0.3cm}
    \end{minipage}
    }
    \caption{Example of Booking Confirmation Email with QR Code}
    \label{fig:email_confirmation}
\end{figure}

\textbf{Email Content Details:}
\begin{itemize}
    \item \textbf{Subject Line}: "Confirmation de Réservation - MyLoc Agency"
    \item \textbf{Recipient}: Customer's registered email address.
    \item \textbf{Body}: Personalized message with customer name and car details.
    \item \textbf{Attachment}: PDF contract with complete booking information.
    \item \textbf{QR Code}: Unique identifier for the booking, scannable at vehicle pickup.
\end{itemize}

\textbf{QR Code Verification Process:}
\begin{enumerate}
    \item Customer arrives at the agency to pick up the vehicle.
    \item Agency staff scans the QR code from the email or PDF.
    \item System verifies the booking details and validity.
    \item If valid, the rental process proceeds.
    \item Booking status updates to "IN\_PROGRESS" or "COMPLETED".
\end{enumerate}

\subsubsection{Rejection Email Example}
When an agency declines a rental request, a simple notification email is sent to inform the customer.

\begin{figure}[h!]
    \centering
    \fbox{
    \begin{minipage}{0.85\textwidth}
    \vspace{0.5cm}
    \begin{center}
    \textbf{\Large Notification de Réservation}
    \end{center}
    \vspace{0.3cm}
    
    \textbf{Email:} zahidaaloui506@gmail.com
    
    \vspace{0.5cm}
    
    \textbf{Message:}
    
    Votre réservation pour \textbf{Toyota Corolla} a été refusée.
    
    \vspace{0.5cm}
    
    \hrule
    \vspace{0.2cm}
    \small
    \textit{MyLoc Agency}
    \vspace{0.3cm}
    \end{minipage}
    }
    \caption{Example of Booking Rejection Email}
    \label{fig:email_rejection}
\end{figure}

\textbf{Note:} Unlike the confirmation email, the rejection email does not include a PDF attachment or QR code. It is a simple notification to inform the customer that their request was not accepted.

\subsubsection{New Car Alert Email (For Followers)}
Followers who subscribed via the website footer receive automatic emails when new cars are added to the platform.

\begin{figure}[h!]
    \centering
    \fbox{
    \begin{minipage}{0.85\textwidth}
    \vspace{0.5cm}
    \begin{center}
    \textbf{\Large New Car Alert}
    \end{center}
    \vspace{0.3cm}
    
    \textbf{Message:}
    
    \vspace{0.3cm}
    
    A new car \textbf{"Mercedes CLA 200"} has just been added to our agency. Check it out now!
    
    \vspace{0.5cm}
    
    \hrule
    \vspace{0.2cm}
    \small
    \textit{MyLoc Agency - You are receiving this email because you subscribed to our alerts.}
    \vspace{0.3cm}
    \end{minipage}
    }
    \caption{Example of New Car Alert Email for Followers}
    \label{fig:email_follower}
\end{figure}

\textbf{Email Types Summary:}
\begin{table}[h!]
\centering
\renewcommand{\arraystretch}{1.3}
\begin{tabular}{|l|c|c|c|}
\hline
\rowcolor{gray!20}
\textbf{Email Type} & \textbf{PDF Attached} & \textbf{QR Code} & \textbf{Recipient} \\
\hline
Booking Confirmation & Yes & Yes & Customer \\
\hline
Booking Rejection & No & No & Customer \\
\hline
New Car Alert & No & No & Followers \\
\hline
\end{tabular}
\caption{Email Types and Their Content}
\label{tab:email_types}
\end{table}

\section{Database Implementation}
The platform uses a MySQL relational database. Entities are mapped via JPA annotations and structured around key objects:

\begin{itemize}
    \item \textbf{Agence Table:} Stores agency profiles and login credentials.
    \item \textbf{Booking Table:} Stores rental requests, dates, customer info, price, and car details.
    \item \textbf{Blog Table:} Contains articles, authors, multimedia content.
    \item \textbf{Voiture Table:} Stores car details (name, type, price, photos).
    \item \textbf{User Table:} Stores customer information and login references.
    \item \textbf{Notification Table:} Stores in-app messages and alert statuses.
\end{itemize}

\section{Screenshots of the Application}
Screenshots illustrate the platform’s functionalities for different user roles:

\begin{itemize}
    \item Admin dashboard with agency management.
    \item Agency dashboard with car CRUD operations.
    \item Customer booking page and rental history view.
    \item Real-time chat interface between admin and agencies.
    \item Generated PDF contract with QR code.
    \item Chatbot interface integrated on the homepage.
\end{itemize}

\begin{figure}[h!]
    \centering
    \includegraphics[width=14cm]{assets/admin-dashboard.png}
    \caption{Admin Dashboard for Managing Agencies}
    \label{admin-dash}
\end{figure}

\begin{figure}[h!]
    \centering
    \includegraphics[width=14cm]{assets/chatbot-demo.png}
    \caption{Chatbot Integration on Homepage}
    \label{chatbot}
\end{figure}

\section{Testing and Validation}
The system has been validated through manual and automated testing.

\subsection{Unit Testing}
\begin{itemize}
    \item Spring Boot unit tests for services and controllers.
    \item REST API endpoints tested with Postman.
    \item Angular unit tests using Jasmine and Karma.
\end{itemize}

\subsection{Integration Testing}
\begin{itemize}
    \item End-to-end testing of booking flow from customer request to agency validation.
    \item Payment processing, PDF generation, and email dispatch tested with mock gateways.
    \item Real-time chat functionality tested between admin and agencies.
\end{itemize}

\subsection{CI/CD Pipeline Validation}
\begin{itemize}
    \item GitLab CI pipelines test build processes, run unit tests, and deploy to Kubernetes.
    \item Docker containers tested locally and in staging environments.
    \item Rollback and hotfix procedures validated.
\end{itemize}

\section{Conclusion}
The implementation phase successfully transformed the design into a robust, functional web platform. All planned modules—from authentication and booking workflows to real-time messaging, automated email notifications, chatbot support, and online payments—have been developed, tested, and deployed. The system is stable, scalable, and provides a seamless digital experience for all user roles.
